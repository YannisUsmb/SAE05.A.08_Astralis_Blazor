@page "/scanner"
@using Astralis_BlazorApp.ViewModels
@inject ScannerViewModel ViewModel

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8 text-center">
            <h1 class="display-4 fw-bold text-white mb-3">Scanner Céleste <span class="text-accent-purple">AI</span></h1>
            <p class="text-white-50 mb-5">
                Chargez une image d'un corps céleste (Planète, Étoile, Galaxie...) et laissez notre Intelligence Artificielle l'identifier pour vous.
            </p>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="glass-panel p-4 rounded-4 border border-white-10 text-center position-relative">

                @if (string.IsNullOrEmpty(ViewModel.ImagePreviewUrl))
                {
                    <div class="upload-zone py-5 border border-2 border-dashed border-white-10 rounded-3">
                        <i class="bi bi-cloud-upload display-1 text-white-50 mb-3"></i>
                        <h5 class="text-white">Glissez une image ici</h5>
                        <p class="text-white-50 small">ou cliquez pour parcourir</p>

                        <InputFile OnChange="@ViewModel.LoadImageAsync"
                                   class="position-absolute top-0 start-0 w-100 h-100 opacity-0"
                                   style="cursor: pointer;"
                                   accept=".jpg,.jpeg,.png" />
                    </div>
                }
                else
                {
                    <div class="preview-container position-relative mb-4">
                        <img src="@ViewModel.ImagePreviewUrl" class="img-fluid rounded-3 shadow-lg" style="max-height: 400px; object-fit: contain;" />

                        @if (ViewModel.IsLoading)
                        {
                            <div class="position-absolute top-0 start-0 w-100 h-100 bg-black bg-opacity-75 rounded-3 d-flex flex-column align-items-center justify-content-center">
                                <div class="spinner-border text-accent-purple mb-3" role="status" style="width: 3rem; height: 3rem;"></div>
                                <span class="text-white animate-pulse">Analyse en cours...</span>
                            </div>
                        }
                    </div>

                    @if (ViewModel.Result != null)
                    {
                        <div class="result-card p-3 rounded-3 bg-success bg-opacity-10 border border-success border-opacity-25 mb-4 animate-fade-in">
                            <h6 class="text-success text-uppercase small fw-bold mb-1">Résultat de l'analyse</h6>
                            <h2 class="text-white fw-bold mb-2">@ViewModel.Result.Prediction</h2>

                            <div class="progress bg-white bg-opacity-10" style="height: 6px;">
                                <div class="progress-bar bg-success" role="progressbar"
                                     style="width: @(ViewModel.Result.Confidence * 100)%;"
                                     aria-valuenow="@(ViewModel.Result.Confidence * 100)" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <p class="text-white-50 small mt-2 mb-0">
                                Confiance : @((ViewModel.Result.Confidence * 100).ToString("F1"))%
                            </p>
                        </div>
                    }

                    @if (!string.IsNullOrEmpty(ViewModel.ErrorMessage))
                    {
                        <div class="alert alert-danger border-0 bg-danger bg-opacity-25 text-white mb-4">
                            <i class="bi bi-exclamation-triangle me-2"></i> @ViewModel.ErrorMessage
                        </div>
                    }

                    <div class="d-flex gap-2 justify-content-center">
                        @if (ViewModel.Result == null && !ViewModel.IsLoading)
                        {
                            <button class="btn btn-astralis-premium px-4 py-2" @onclick="ViewModel.AnalyzeImageAsync">
                                <i class="bi bi-magic me-2"></i> Identifier
                            </button>
                        }

                        <button class="btn btn-outline-light px-4 py-2" @onclick="ViewModel.Reset">
                            <i class="bi bi-arrow-counterclockwise me-2"></i> Nouvelle image
                        </button>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<style>
    .upload-zone {
        transition: all 0.3s ease;
    }

        .upload-zone:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--bs-primary) !important;
        }

    .animate-pulse {
        animation: pulse 1.5s infinite;
    }

    @@keyframes pulse {
        0% {
            opacity: 0.6;
        }

        50% {
            opacity: 1;
        }

        100% {
            opacity: 0.6;
        }
    }
</style>