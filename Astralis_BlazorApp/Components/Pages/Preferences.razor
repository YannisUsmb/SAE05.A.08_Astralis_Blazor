@page "/parametres/preferences"
@layout SettingsLayout
@using Astralis.Shared.DTOs
@using Astralis_BlazorApp.ViewModels
@using Astralis_BlazorApp.Components.Layout
@inject PreferencesViewModel ViewModel

<h3 class="text-white mb-4">Préférences de Notification</h3>

@if (ViewModel.IsLoading)
{
    <div class="text-center py-5">
        <div class="spinner-border text-accent-purple" role="status"></div>
    </div>
}
else
{
    <div class="glass-panel p-4 rounded-3 border border-white-10">

        <p class="text-white-50 mb-4">
            Gérez les notifications que vous souhaitez recevoir par e-mail.
            Les notifications sur le site resteront toujours actives.
        </p>

        @* @if (!string.IsNullOrEmpty(ViewModel.SuccessMessage))
        {
            <div class="alert alert-success border-0 bg-success bg-opacity-25 text-white mb-4 animate-fade-in">
                <i class="bi bi-check-circle me-2"></i> @ViewModel.SuccessMessage
            </div>
        } *@

        @if (!string.IsNullOrEmpty(ViewModel.ErrorMessage))
        {
            <div class="alert alert-danger border-0 bg-danger bg-opacity-25 text-white mb-4 animate-fade-in">
                <i class="bi bi-exclamation-triangle me-2"></i> @ViewModel.ErrorMessage
            </div>
        }

        @if (ViewModel.Preferences.Any())
        {
            <div class="preferences-list">
                @foreach (var pref in ViewModel.Preferences)
                {
                    <div class="d-flex align-items-center justify-content-between py-3 border-bottom border-white-10 preference-item">
                        <div class="pe-3">
                            <h6 class="text-white mb-1">@pref.NotificationTypeName</h6>
                            <p class="text-white-50 small mb-0">@pref.NotificationTypeDescription</p>
                        </div>

                        <div class="form-check form-switch custom-switch">
                            <input class="form-check-input" type="checkbox" role="switch"
                                   checked="@pref.ByMail"
                                   @onchange="() => ViewModel.TogglePreference(pref)">
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="text-center text-white-50 py-4">
                Aucune préférence disponible.
            </div>
        }
    </div>
}

@code {
    protected override async Task OnInitializedAsync()
    {
        await ViewModel.InitializeAsync();
    }
}