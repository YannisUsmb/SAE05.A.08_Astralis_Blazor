@page "/settings"
@page "/settings/account"
@layout SettingsLayout
@using Astralis.Shared.DTOs
@using Astralis_BlazorApp.Components.Layout
@inject AccountViewModel ViewModel

<h3 class="text-white mb-4">Mon Compte</h3>

@if (!string.IsNullOrEmpty(ViewModel.SuccessMessage))
{
    <div class="alert alert-success border-0 bg-success bg-opacity-25 text-white mb-4">
        <i class="bi bi-check-circle me-2"></i> @ViewModel.SuccessMessage
    </div>
}
@if (!string.IsNullOrEmpty(ViewModel.ErrorMessage))
{
    <div class="alert alert-danger border-0 bg-danger bg-opacity-25 text-white mb-4">
        <i class="bi bi-exclamation-triangle me-2"></i> @ViewModel.ErrorMessage
    </div>
}

<div class="mb-5">
    <h5 class="text-accent-blue mb-3">Informations de connexion</h5>

    <div class="row g-3">
        <div class="col-md-6">
            <label class="form-label text-white-50 small">Email Actuel</label>
            <input type="text" class="form-control bg-transparent text-white border-secondary" value="@ViewModel.CurrentEmail" disabled />
        </div>

        <div class="col-md-6">
            <label class="form-label text-white-50 small">Nouvel Email</label>
            <input type="email" class="form-control bg-transparent text-white border-secondary" @bind="ViewModel.NewEmail" />
        </div>
    </div>

    <div class="mt-3 text-end">
        <button class="btn btn-astralis-outline btn-sm" @onclick="ViewModel.UpdateEmailAsync">Enregistrer l'email</button>
    </div>
</div>

<hr class="border-secondary my-5" />

<div class="mb-5">
    <h5 class="text-accent-purple mb-3">Changer de mot de passe</h5>

    <EditForm Model="@ViewModel.PasswordModel" OnValidSubmit="ViewModel.ChangePasswordAsync">
        <DataAnnotationsValidator />
        <ValidationSummary class="text-danger small mb-3" />

        <div class="row g-3">
            <div class="col-12">
                <label class="form-label text-white-50 small">Mot de passe actuel</label>
                <InputText type="password" class="form-control bg-transparent text-white border-secondary" @bind-Value="ViewModel.PasswordModel.CurrentPassword" />
            </div>

            <div class="col-md-6">
                <label class="form-label text-white-50 small">Nouveau mot de passe</label>
                <InputText type="password" class="form-control bg-transparent text-white border-secondary" @bind-Value="ViewModel.PasswordModel.NewPassword" />
            </div>

            <div class="col-md-6">
                <label class="form-label text-white-50 small">Confirmer le nouveau mot de passe</label>
                <InputText type="password" class="form-control bg-transparent text-white border-secondary" @bind-Value="ViewModel.PasswordModel.ConfirmNewPassword" />
            </div>
        </div>

        <div class="mt-4 text-end">
            <button type="submit" class="btn btn-astralis-premium btn-sm">Mettre à jour le mot de passe</button>
        </div>
    </EditForm>
</div>

<hr class="border-secondary my-5" />

<div class="danger-zone p-4">
    <h5 class="text-danger mb-2">Zone de danger</h5>
    <p class="text-white-50 small mb-4">
        Gérez la fin de vie de votre compte Astralis. Ces actions sont irréversibles.
    </p>

    <div class="d-flex justify-content-end gap-3">
        <button class="btn btn-outline-warning btn-sm text-warning-emphasis" @onclick="ShowAnonymizeConfirmation">
            <i class="bi bi-incognito me-1"></i> Anonymiser mes données
        </button>

        <button class="btn btn-outline-danger btn-sm" @onclick="ShowDeleteConfirmation">
            <i class="bi bi-trash me-1"></i> Supprimer mon compte
        </button>
    </div>
</div>

@code {
    protected override async Task OnInitializedAsync()
    {
        await ViewModel.LoadUserDataAsync();
    }

    private void ShowDeleteConfirmation()
    {
        Console.WriteLine("Demande de suppression");
    }

    private void ShowAnonymizeConfirmation()
    {
        Console.WriteLine("Demande d'anonymisation");
    }
}